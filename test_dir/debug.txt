"**Modal âŒ failure**
> âŒ Benchmarking failed

Running on:
* GPU: `NVIDIA B200`
* CPU: `x86_64`
* Device count: `1`
* Runtime: `CUDA`
* Platform: `Linux-4.4.0-x86_64-with-glibc2.39`
* Torch: `2.9.1+cu129`
* Hostname: `modal`


## Benchmarks:
```
batch: 1; num_pages: 32; seq_len: 2048; seed: 100
 â± 66080.9 Â± 63.54 Âµs
 âš¡ 65913.2 Âµs ðŸŒ 66194.9 Âµs
 âŒ mismatch found! first mismatch at (0, 0): got=1354 ref=245

batch: 8; num_pages: 64; seq_len: 4096; seed: 101
 â± 153162.9 Â± 40.21 Âµs
 âš¡ 153084.6 Âµs ðŸŒ 153218.0 Âµs
 âŒ mismatch found! first mismatch at (0, 0): got=2180 ref=2748

batch: 16; num_pages: 128; seq_len: 8192; seed: 102
 â± 246273.4 Â± 50.05 Âµs
 âš¡ 246177.4 Âµs ðŸŒ 246345.9 Âµs
 âŒ mismatch found! first mismatch at (0, 0): got=781 ref=99
```

## Program stdout:
```
[1/3] c++ -MMD -MF main.o.d -DTORCH_EXTENSION_NAME=dsa_topk_indexer_debug_ext -DTORCH_API_INCLUDE_EXTENSION_H -isystem /usr/local/lib/python3.12/dist-packages/torch/include -isystem /usr/local/lib/python3.12/dist-packages/torch/include/torch/csrc/api/include -isystem /usr/local/cuda/include -isystem /usr/include/python3.12 -fPIC -std=c++17 -c /root/.cache/torch_extensions/py312_cu129/dsa_topk_indexer_debug_ext/main.cpp -o main.o 
[2/3] /usr/local/cuda/bin/nvcc --generate-dependencies-with-compile --dependency-output cuda.cuda.o.d -DTORCH_EXTENSION_NAME=dsa_topk_indexer_debug_ext -DTORCH_API_INCLUDE_EXTENSION_H -isystem /usr/local/lib/python3.12/dist-packages/torch/include -isystem /usr/local/lib/python3.12/dist-packages/torch/include/torch/csrc/api/include -isystem /usr/local/cuda/include -isystem /usr/include/python3.12 -D__CUDA_NO_HALF_OPERATORS__ -D__CUDA_NO_HALF_CONVERSIONS__ -D__CUDA_NO_BFLOAT16_CONVERSIONS__ -D__CUDA_NO_HALF2_OPERATORS__ --expt-relaxed-constexpr --compiler-options '-fPIC' -O0 -gencode=arch=compute_100a,code=sm_100a --threads=4 -std=c++17 -c /root/.cache/torch_extensions/py312_cu129/dsa_topk_indexer_debug_ext/cuda.cu -o cuda.cuda.o 
[3/3] c++ main.o cuda.cuda.o -shared -lcuda -L/usr/local/lib/python3.12/dist-packages/torch/lib -lc10 -lc10_cuda -ltorch_cpu -ltorch_cuda -ltorch -ltorch_python -L/usr/local/cuda/lib64 -lcudart -o dsa_topk_indexer_debug_ext.so
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40900c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40900a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409002c00, k_index_cache=0x2ae40900a000, weights=0x2ae409004c00
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40900c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40900a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409002c00, k_index_cache=0x2ae40900a000, weights=0x2ae409004c00
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=1 num_pages=32 max_num_pages=32 topk=2048
[HOST DBG] q shape: [1, 64, 128], dtype=24
[HOST DBG] k shape: [32, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae40914c000, globalDim={256,32}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae40914a000, globalDim={128,64,32}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=1
[DBG] kernel entry: b=0 batch_size=1 num_pages=32 max_num_pages=32 topk=2048 seq_len=2048
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG] smem alignment: raw%1024=0
[DBG] smem total used: 114880 bytes
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG] payload TMA dest align%128: stage0=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] mbarrier init done, fence done
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] num_tiles=32, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409008000, k_index_cache=0x2ae40914a000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-3.667999 scale=0.581885 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.282043 scale=0.581885 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.134352 w=0.145310 partial_sum=8.650246
[DBG]   v=-7.146732 w=0.811740 partial_sum=19.892292
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 1354 1876 1940 1748 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=8 num_pages=64 max_num_pages=64 topk=2048
[HOST DBG] q shape: [8, 64, 128], dtype=24
[HOST DBG] k shape: [64, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae409402000, globalDim={256,64}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae409400000, globalDim={128,64,64}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=8
[DBG] kernel entry: b=0 batch_size=8 num_pages=64 max_num_pages=64 topk=2048 seq_len=4096
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=13.936493 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.131775 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=22.427185 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=1.144051 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-6.770264 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.742706 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.549515 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-14.922882 scale=0.535320 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.297668 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-19.697144 scale=0.535320 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.289185 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-11.755272 scale=0.535320 tmem_row=32
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] epilogue tile=0 t=0 epi_warp=0: d=5.791931 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-14.034821 scale=0.535320 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=7.460487 w=0.559869 partial_sum=31.922787
[DBG]   v=12.005727 w=0.078701 partial_sum=21.379017
[DBG]   v=-7.029706 w=0.983902 partial_sum=17.387985
[DBG]   v=0.612433 w=0.030509 partial_sum=20.377871
[DBG]   v=-7.988522 w=0.073934 partial_sum=36.260410
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-5.750789 w=0.369509 partial_sum=18.255629
[DBG]   v=-3.624259 w=0.062070 partial_sum=24.097610
[DBG]   v=-6.718010 w=0.635078 partial_sum=13.498322
[DBG]   v=-10.544280 w=0.798007 partial_sum=23.395510
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.300629 w=0.956699 partial_sum=23.328083
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.113970 w=0.027408 partial_sum=19.188152
[DBG]   v=3.100538 w=0.227282 partial_sum=12.876743
[DBG]   v=-6.292836 w=0.692178 partial_sum=15.549598
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.513124 w=0.788304 partial_sum=21.579969
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] payload TMA dest align%128: stage0=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] mbarrier init done, fence done
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] num_tiles=64, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae4091d9000, k_index_cache=0x2ae409400000, weights=0x2ae4091e9000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.527893 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-24.305801 scale=0.535320 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-13.011389 w=0.573035 partial_sum=9.821249
[DBG]   v=1.888553 w=0.567841 partial_sum=24.889017
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 2180 491 595 2895 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=8 num_pages=64 max_num_pages=64 topk=2048
[HOST DBG] q shape: [8, 64, 128], dtype=24
[HOST DBG] k shape: [64, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae4090d2000, globalDim={256,64}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae4090d0000, globalDim={128,64,64}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=8
[DBG] kernel entry: b=0 batch_size=8 num_pages=64 max_num_pages=64 topk=2048 seq_len=4096
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.742706 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-6.770264 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-14.922882 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.549515 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=13.936493 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.131775 scale=0.535320 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=22.427185 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=1.144051 scale=0.535320 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=5.791931 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-14.034821 scale=0.535320 tmem_row=32
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-11.755272 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.289185 scale=0.535320 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.297668 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-19.697144 scale=0.535320 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.988522 w=0.073934 partial_sum=36.260410
[DBG]   v=-7.029706 w=0.983902 partial_sum=17.387985
[DBG]   v=-5.750789 w=0.369509 partial_sum=18.255629
[DBG]   v=-3.624259 w=0.062070 partial_sum=24.097610
[DBG]   v=-6.718010 w=0.635078 partial_sum=13.498322
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   v=0.612433 w=0.030509 partial_sum=20.377871
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=7.460487 w=0.559869 partial_sum=31.922787
[DBG]   v=-7.513124 w=0.788304 partial_sum=21.579969
[DBG]   v=12.005727 w=0.078701 partial_sum=21.379017
[DBG]   v=3.100538 w=0.227282 partial_sum=12.876743
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-6.292836 w=0.692178 partial_sum=15.549598
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.300629 w=0.956699 partial_sum=23.328083
[DBG]   v=-7.113970 w=0.027408 partial_sum=19.188152
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   v=-10.544280 w=0.798007 partial_sum=23.395510
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] payload TMA dest align%128: stage0=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] mbarrier init done, fence done
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] num_tiles=64, actual_topk=2048
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409040000, k_index_cache=0x2ae4090d0000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.527893 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-24.305801 scale=0.535320 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=1.888553 w=0.567841 partial_sum=24.889017
[DBG]   v=-13.011389 w=0.573035 partial_sum=9.821249
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 2180 491 595 2895 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=8 num_pages=64 max_num_pages=64 topk=2048
[HOST DBG] q shape: [8, 64, 128], dtype=24
[HOST DBG] k shape: [64, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae4090d2000, globalDim={256,64}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae4090d0000, globalDim={128,64,64}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=8
[DBG] kernel entry: b=0 batch_size=8 num_pages=64 max_num_pages=64 topk=2048 seq_len=4096
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-14.922882 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.549515 scale=0.535320 tmem_row=32
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=22.427185 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=1.144051 scale=0.535320 tmem_row=32
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-11.755272 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.289185 scale=0.535320 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=13.936493 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.131775 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-6.770264 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.742706 scale=0.535320 tmem_row=0
[DBG]   v=-7.988522 w=0.073934 partial_sum=36.260410
[DBG]   v=-6.718010 w=0.635078 partial_sum=13.498322
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-14.034821 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=5.791931 scale=0.535320 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-19.697144 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.297668 scale=0.535320 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=12.005727 w=0.078701 partial_sum=21.379017
[DBG]   v=0.612433 w=0.030509 partial_sum=20.377871
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.113970 w=0.027408 partial_sum=19.188152
[DBG]   v=-3.624259 w=0.062070 partial_sum=24.097610
[DBG]   v=-6.292836 w=0.692178 partial_sum=15.549598
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.029706 w=0.983902 partial_sum=17.387985
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=7.460487 w=0.559869 partial_sum=31.922787
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   v=-5.750789 w=0.369509 partial_sum=18.255629
[DBG]   v=-7.513124 w=0.788304 partial_sum=21.579969
[DBG] payload TMA dest align%128: stage0=0
[DBG]   v=-10.544280 w=0.798007 partial_sum=23.395510
[DBG]   v=3.100538 w=0.227282 partial_sum=12.876743
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-2.300629 w=0.956699 partial_sum=23.328083
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG] MMA tile=1 stage=1 valid=64
[DBG] mbarrier init done, fence done
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] num_tiles=64, actual_topk=2048
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409040000, k_index_cache=0x2ae4090d0000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-24.305801 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.527893 scale=0.535320 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-13.011389 w=0.573035 partial_sum=9.821249
[DBG]   v=1.888553 w=0.567841 partial_sum=24.889017
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 2180 491 595 2895 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=8 num_pages=64 max_num_pages=64 topk=2048
[HOST DBG] q shape: [8, 64, 128], dtype=24
[HOST DBG] k shape: [64, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae4090d2000, globalDim={256,64}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae4090d0000, globalDim={128,64,64}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=8
[DBG] kernel entry: b=0 batch_size=8 num_pages=64 max_num_pages=64 topk=2048 seq_len=4096
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=22.427185 scale=0.535320 tmem_row=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=1.144051 scale=0.535320 tmem_row=32
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.131775 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=13.936493 scale=0.535320 tmem_row=32
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-6.770264 scale=0.535320 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.742706 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-14.922882 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.549515 scale=0.535320 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=5.791931 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-14.034821 scale=0.535320 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-13.289185 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-11.755272 scale=0.535320 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=0.612433 w=0.030509 partial_sum=20.377871
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=12.005727 w=0.078701 partial_sum=21.379017
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.297668 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-19.697144 scale=0.535320 tmem_row=32
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.029706 w=0.983902 partial_sum=17.387985
[DBG]   v=-3.624259 w=0.062070 partial_sum=24.097610
[DBG]   v=-7.988522 w=0.073934 partial_sum=36.260410
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=7.460487 w=0.559869 partial_sum=31.922787
[DBG]   v=-5.750789 w=0.369509 partial_sum=18.255629
[DBG]   v=3.100538 w=0.227282 partial_sum=12.876743
[DBG]   v=-6.718010 w=0.635078 partial_sum=13.498322
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.113970 w=0.027408 partial_sum=19.188152
[DBG]   v=-7.513124 w=0.788304 partial_sum=21.579969
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-6.292836 w=0.692178 partial_sum=15.549598
[DBG]   tma2d coords: x=0 y=1
[DBG] payload TMA dest align%128: stage0=0
[DBG]   v=-2.300629 w=0.956699 partial_sum=23.328083
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   v=-10.544280 w=0.798007 partial_sum=23.395510
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   page_idx=0 token_id=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] mbarrier init done, fence done
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] num_tiles=64, actual_topk=2048
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409040000, k_index_cache=0x2ae4090d0000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.527893 scale=0.535320 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-24.305801 scale=0.535320 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=1.888553 w=0.567841 partial_sum=24.889017
[DBG]   v=-13.011389 w=0.573035 partial_sum=9.821249
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 2180 491 595 2895 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=16 num_pages=128 max_num_pages=128 topk=2048
[HOST DBG] q shape: [16, 64, 128], dtype=24
[HOST DBG] k shape: [128, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae3f0a32000, globalDim={256,128}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae3f0a30000, globalDim={128,64,128}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=16
[DBG] kernel entry: b=0 batch_size=16 num_pages=128 max_num_pages=128 topk=2048 seq_len=8192
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=31.802246 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=25.560303 scale=0.895402 tmem_row=32
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-34.618561 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.299316 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.524963 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=0.266418 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=5.583923 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.236496 scale=0.895402 tmem_row=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=17.661392 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.655396 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=13.712006 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=11.425812 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.598145 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-11.022736 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.800812 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=3.412598 scale=0.895402 tmem_row=32
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-16.965149 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.763702 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-0.198242 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-3.552856 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.560181 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.947510 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.593338 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-1.223511 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=2.475342 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.161163 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-40.209000 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.416199 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.670105 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.476860 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-11.012832 w=0.160574 partial_sum=34.580639
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=28.475794 w=0.449349 partial_sum=18.891052
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-9.424073 w=0.002667 partial_sum=46.090954
[DBG]   v=0.238552 w=0.548946 partial_sum=48.978142
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=2.897965 w=0.709546 partial_sum=60.217144
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=22.886745 w=0.323125 partial_sum=48.341049
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-30.997526 w=0.861560 partial_sum=31.695318
[DBG]   v=4.999856 w=0.772205 partial_sum=24.230318
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   v=2.377646 w=0.599704 partial_sum=37.614628
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=12.277757 w=0.433769 partial_sum=32.695908
[DBG]   v=-11.280403 w=0.769304 partial_sum=49.280430
[DBG]   v=-0.177506 w=0.334303 partial_sum=49.604794
[DBG]   v=-4.265429 w=0.282200 partial_sum=23.946655
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=15.814045 w=0.879726 partial_sum=82.540894
[DBG]   v=14.148078 w=0.586051 partial_sum=36.126801
[DBG]   v=3.055647 w=0.490645 partial_sum=49.546066
[DBG]   v=-9.869779 w=0.741866 partial_sum=22.579189
[DBG]   v=10.230694 w=0.592648 partial_sum=76.213509
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.664803 w=0.571799 partial_sum=40.782589
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-15.190627 w=0.748774 partial_sum=42.977043
[DBG]   v=-36.003216 w=0.791023 partial_sum=39.798283
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-3.181235 w=0.584986 partial_sum=23.991882
[DBG]   v=-5.325412 w=0.586033 partial_sum=32.835457
[DBG]   v=2.163469 w=0.586640 partial_sum=38.365414
[DBG]   v=2.216426 w=0.159105 partial_sum=32.769363
[DBG]   v=-4.903991 w=0.507247 partial_sum=30.519024
[DBG]   v=-7.694492 w=0.466043 partial_sum=76.343315
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-1.095534 w=0.560828 partial_sum=30.867941
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG] payload TMA dest align%128: stage0=0
[DBG]   v=-7.307522 w=0.845738 partial_sum=30.368074
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=14.031043 w=0.999300 partial_sum=38.478996
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] mbarrier init done, fence done
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] num_tiles=128, actual_topk=2048
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409026400, k_index_cache=0x2ae3f0a30000, weights=0x2ae409046400
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.178955 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=24.476059 scale=0.895402 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=21.915911 w=0.258616 partial_sum=49.343758
[DBG]   v=2.846443 w=0.347857 partial_sum=78.901123
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 781 8063 5347 5686 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=16 num_pages=128 max_num_pages=128 topk=2048
[HOST DBG] q shape: [16, 64, 128], dtype=24
[HOST DBG] k shape: [128, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae3f0822000, globalDim={256,128}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae3f0820000, globalDim={128,64,128}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=16
[DBG] kernel entry: b=0 batch_size=16 num_pages=128 max_num_pages=128 topk=2048 seq_len=8192
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] MMA tile=0 stage=0 valid=64
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   tma2d coords: x=0 y=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=11.425812 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=13.712006 scale=0.895402 tmem_row=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-1.223511 scale=0.895402 tmem_row=32
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.593338 scale=0.895402 tmem_row=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=5.583923 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.236496 scale=0.895402 tmem_row=0
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.670105 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.476860 scale=0.895402 tmem_row=32
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-16.965149 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.763702 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.800812 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=3.412598 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-34.618561 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.299316 scale=0.895402 tmem_row=32
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.416199 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-40.209000 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=17.661392 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.655396 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=25.560303 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=31.802246 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-0.198242 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-3.552856 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.161163 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=2.475342 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.598145 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-11.022736 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=12.277757 w=0.433769 partial_sum=32.695908
[DBG]   v=10.230694 w=0.592648 partial_sum=76.213509
[DBG]   v=-1.095534 w=0.560828 partial_sum=30.867941
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.947510 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.560181 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-7.694492 w=0.466043 partial_sum=76.343315
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=2.897965 w=0.709546 partial_sum=60.217144
[DBG]   v=4.999856 w=0.772205 partial_sum=24.230318
[DBG]   v=-4.265429 w=0.282200 partial_sum=23.946655
[DBG]   v=14.031043 w=0.999300 partial_sum=38.478996
[DBG]   v=14.148078 w=0.586051 partial_sum=36.126801
[DBG]   v=-4.903991 w=0.507247 partial_sum=30.519024
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-11.012832 w=0.160574 partial_sum=34.580639
[DBG]   v=-15.190627 w=0.748774 partial_sum=42.977043
[DBG]   v=2.163469 w=0.586640 partial_sum=38.365414
[DBG]   v=3.055647 w=0.490645 partial_sum=49.546066
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.524963 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=0.266418 scale=0.895402 tmem_row=32
[DBG]   v=28.475794 w=0.449349 partial_sum=18.891052
[DBG]   v=-0.177506 w=0.334303 partial_sum=49.604794
[DBG]   v=15.814045 w=0.879726 partial_sum=82.540894
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-30.997526 w=0.861560 partial_sum=31.695318
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-36.003216 w=0.791023 partial_sum=39.798283
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=2.377646 w=0.599704 partial_sum=37.614628
[DBG]   v=-7.307522 w=0.845738 partial_sum=30.368074
[DBG]   v=22.886745 w=0.323125 partial_sum=48.341049
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=2.216426 w=0.159105 partial_sum=32.769363
[DBG]   v=-3.181235 w=0.584986 partial_sum=23.991882
[DBG]   v=-7.664803 w=0.571799 partial_sum=40.782589
[DBG]   v=-9.869779 w=0.741866 partial_sum=22.579189
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma2d coords: x=0 y=1
[DBG] payload TMA dest align%128: stage0=0
[DBG]   v=-11.280403 w=0.769304 partial_sum=49.280430
[DBG]   v=-5.325412 w=0.586033 partial_sum=32.835457
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   v=0.238552 w=0.548946 partial_sum=48.978142
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   v=-9.424073 w=0.002667 partial_sum=46.090954
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   tma2d coords: x=0 y=1
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   tma2d coords: x=0 y=1
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   page_idx=0 token_id=0
[DBG] mbarrier init done, fence done
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] num_tiles=128, actual_topk=2048
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] q_index_bytes=0x2ae409080000, k_index_cache=0x2ae3f0820000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.178955 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=24.476059 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=2.846443 w=0.347857 partial_sum=78.901123
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=21.915911 w=0.258616 partial_sum=49.343758
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 781 8063 5347 5686 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=16 num_pages=128 max_num_pages=128 topk=2048
[HOST DBG] q shape: [16, 64, 128], dtype=24
[HOST DBG] k shape: [128, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae3f0822000, globalDim={256,128}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae3f0820000, globalDim={128,64,128}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=16
[DBG] kernel entry: b=0 batch_size=16 num_pages=128 max_num_pages=128 topk=2048 seq_len=8192
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.763702 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-16.965149 scale=0.895402 tmem_row=32
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.593338 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-1.223511 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=11.425812 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=13.712006 scale=0.895402 tmem_row=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=3.412598 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.800812 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=31.802246 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=25.560303 scale=0.895402 tmem_row=32
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-11.022736 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.598145 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-3.552856 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-0.198242 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.161163 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=2.475342 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.476860 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.670105 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.416199 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-40.209000 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-34.618561 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.299316 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=5.583923 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.236496 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.655396 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=17.661392 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=0.266418 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.524963 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-4.265429 w=0.282200 partial_sum=23.946655
[DBG]   v=-15.190627 w=0.748774 partial_sum=42.977043
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=10.230694 w=0.592648 partial_sum=76.213509
[DBG]   v=-1.095534 w=0.560828 partial_sum=30.867941
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-7.694492 w=0.466043 partial_sum=76.343315
[DBG]   v=12.277757 w=0.433769 partial_sum=32.695908
[DBG]   v=22.886745 w=0.323125 partial_sum=48.341049
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   v=14.148078 w=0.586051 partial_sum=36.126801
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=2.216426 w=0.159105 partial_sum=32.769363
[DBG]   v=28.475794 w=0.449349 partial_sum=18.891052
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.560181 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.947510 scale=0.895402 tmem_row=32
[DBG]   v=-9.869779 w=0.741866 partial_sum=22.579189
[DBG]   v=-11.280403 w=0.769304 partial_sum=49.280430
[DBG]   v=-3.181235 w=0.584986 partial_sum=23.991882
[DBG]   v=3.055647 w=0.490645 partial_sum=49.546066
[DBG]   v=-30.997526 w=0.861560 partial_sum=31.695318
[DBG]   v=2.163469 w=0.586640 partial_sum=38.365414
[DBG]   v=-4.903991 w=0.507247 partial_sum=30.519024
[DBG]   v=4.999856 w=0.772205 partial_sum=24.230318
[DBG]   v=-7.307522 w=0.845738 partial_sum=30.368074
[DBG]   v=-36.003216 w=0.791023 partial_sum=39.798283
[DBG]   v=-11.012832 w=0.160574 partial_sum=34.580639
[DBG]   v=-0.177506 w=0.334303 partial_sum=49.604794
[DBG]   v=14.031043 w=0.999300 partial_sum=38.478996
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=2.897965 w=0.709546 partial_sum=60.217144
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=15.814045 w=0.879726 partial_sum=82.540894
[DBG]   v=2.377646 w=0.599704 partial_sum=37.614628
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=0.238552 w=0.548946 partial_sum=48.978142
[DBG]   tma2d coords: x=0 y=1
[DBG]   v=-9.424073 w=0.002667 partial_sum=46.090954
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG] payload TMA dest align%128: stage0=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   v=-7.664803 w=0.571799 partial_sum=40.782589
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   v=-5.325412 w=0.586033 partial_sum=32.835457
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   page_idx=0 token_id=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   page_idx=0 token_id=0
[DBG] mbarrier init done, fence done
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] num_tiles=128, actual_topk=2048
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409080000, k_index_cache=0x2ae3f0820000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=24.476059 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.178955 scale=0.895402 tmem_row=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=21.915911 w=0.258616 partial_sum=49.343758
[DBG]   v=2.846443 w=0.347857 partial_sum=78.901123
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 781 8063 5347 5686 (topk_count=2048)
[DBG] kernel exit
[HOST DBG] kernel completed successfully
[HOST DBG] launch: batch=16 num_pages=128 max_num_pages=128 topk=2048
[HOST DBG] q shape: [16, 64, 128], dtype=24
[HOST DBG] k shape: [128, 64, 1, 132], dtype=1
[HOST DBG] scale TMA: base=0x2ae3f0822000, globalDim={256,128}, stride={8448}, boxDim={256,1}
[HOST DBG] payload TMA: base=0x2ae3f0820000, globalDim={128,64,128}, stride={128,8448}, boxDim={128,64,1}
[HOST DBG] smem: need=114880, max_optin=232448, desired=233472
[HOST DBG] dynamic_smem_bytes=232448, threads=128, blocks=16
[DBG] kernel entry: b=0 batch_size=16 num_pages=128 max_num_pages=128 topk=2048 seq_len=8192
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG] smem_raw=0x2ae200000400 (generic), smem_shared_addr=0x400
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG] smem alignment: raw%1024=0
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG] smem total used: 114880 bytes
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG] k_stage_payload: offset=0, shared=0x400
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] k_stage_scale: offset=81920, shared=0x14400
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG] q_stage: offset=84480, shared=0x14e00
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] w_stage: offset=92672, shared=0x16e00
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   tma2d coords: x=0 y=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] tma_mbar: offset=93128, shared=0x16fc8, align%8=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG] mma_mbar: offset=93208, shared=0x17018, align%8=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG] epi_mbar: offset=93288, shared=0x17068, align%8=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] tmem_addr_scratch: offset=114876, shared=0x1c4bc
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=11.425812 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=13.712006 scale=0.895402 tmem_row=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-34.618561 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.299316 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-1.223511 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.593338 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.800812 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=3.412598 scale=0.895402 tmem_row=32
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=15.670105 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.476860 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] topk_scores: offset=98488, shared=0x184b8
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-12.598145 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-11.022736 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-16.965149 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-4.763702 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=25.560303 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=31.802246 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-40.209000 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.416199 scale=0.895402 tmem_row=0
[DBG]   v=12.277757 w=0.433769 partial_sum=32.695908
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.236496 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=5.583923 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-10.524963 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=0.266418 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=10.230694 w=0.592648 partial_sum=76.213509
[DBG] epilogue tile=0 t=0 epi_warp=1: d=17.661392 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=2.655396 scale=0.895402 tmem_row=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=3.055647 w=0.490645 partial_sum=49.546066
[DBG]   v=-7.694492 w=0.466043 partial_sum=76.343315
[DBG]   v=-11.012832 w=0.160574 partial_sum=34.580639
[DBG]   v=-30.997526 w=0.861560 partial_sum=31.695318
[DBG] epilogue tile=0 t=0 epi_warp=1: d=2.475342 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.161163 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-5.947510 scale=0.895402 tmem_row=32
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-8.560181 scale=0.895402 tmem_row=0
[DBG]   v=14.148078 w=0.586051 partial_sum=36.126801
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   v=-1.095534 w=0.560828 partial_sum=30.867941
[DBG] topk_ids: offset=106680, shared=0x1a4b8
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG] epilogue tile=0 t=0 epi_warp=0: d=-0.198242 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=-3.552856 scale=0.895402 tmem_row=32
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-4.903991 w=0.507247 partial_sum=30.519024
[DBG]   v=-4.265429 w=0.282200 partial_sum=23.946655
[DBG]   v=-9.869779 w=0.741866 partial_sum=22.579189
[DBG]   v=14.031043 w=0.999300 partial_sum=38.478996
[DBG]   v=-11.280403 w=0.769304 partial_sum=49.280430
[DBG]   v=-15.190627 w=0.748774 partial_sum=42.977043
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=22.886745 w=0.323125 partial_sum=48.341049
[DBG]   v=28.475794 w=0.449349 partial_sum=18.891052
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   v=2.163469 w=0.586640 partial_sum=38.365414
[DBG]   page_idx=0 token_id=0
[DBG]   v=2.377646 w=0.599704 partial_sum=37.614628
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=4.999856 w=0.772205 partial_sum=24.230318
[DBG]   v=2.897965 w=0.709546 partial_sum=60.217144
[DBG]   v=-9.424073 w=0.002667 partial_sum=46.090954
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   v=15.814045 w=0.879726 partial_sum=82.540894
[DBG]   v=-36.003216 w=0.791023 partial_sum=39.798283
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   v=0.238552 w=0.548946 partial_sum=48.978142
[DBG] payload TMA dest align%128: stage0=0
[DBG]   v=-7.307522 w=0.845738 partial_sum=30.368074
[DBG]   page_idx=0 token_id=0
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=-5.325412 w=0.586033 partial_sum=32.835457
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   v=-7.664803 w=0.571799 partial_sum=40.782589
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   v=-0.177506 w=0.334303 partial_sum=49.604794
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   tma2d coords: x=0 y=1
[DBG]   v=2.216426 w=0.159105 partial_sum=32.769363
[DBG]   page_idx=0 token_id=0
[DBG]   v=-3.181235 w=0.584986 partial_sum=23.991882
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG] scale TMA dest align%128: stage0=0 (addr=0x14400)
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   tma2d coords: x=0 y=1
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] mbarrier init done, fence done
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] MMA tile=1 stage=1 valid=64
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG] tmem_addr_scratch[0] = 0 (TMEM base addr)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] kIdesc = 0x4100010 (atype=E4M3, btype=E4M3, dtype=F32, N=64>>3, M=64>>4)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] num_tiles=128, actual_topk=2048
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] k_fp8_tmap=0x2ae42ce00000, k_scale_tmap=0x2ae42ce00200
[DBG] q_index_bytes=0x2ae409080000, k_index_cache=0x2ae3f0820000, weights=0x2ae409000000
[DBG] producer tile=0 stage=0 page_idx=0 valid=64
[DBG]   payload_dst=0x400 (align%128=0)
[DBG]   scale_dst=0x14400 (align%128=0)
[DBG]   mbar_addr=0x16fc8 (align%8=0)
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG]   tma3d coords: x=0 y=0 z=0
[DBG]   tma2d coords: x=0 y=0
[DBG] MMA tile=0 stage=0 valid=64
[DBG] producer tile=1 stage=1 page_idx=1 valid=64
[DBG]   payload_dst=0x2400 (align%128=0)
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x400 (align%128=0)
[DBG]   scale_dst=0x14500 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000040
[DBG]   mbar_addr=0x16fd0 (align%8=0)
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG]   expect_tx=8448 (payload=8192 + scale=256)
[DBG] epilogue tile=0 t=0 epi_warp=0: d=3.178955 scale=0.895402 tmem_row=0
[DBG] epilogue tile=0 t=0 epi_warp=1: d=24.476059 scale=0.895402 tmem_row=32
[DBG]   tma3d coords: x=0 y=0 z=1
[DBG]   v=2.846443 w=0.347857 partial_sum=78.901123
[DBG]   v=21.915911 w=0.258616 partial_sum=49.343758
[DBG]   tma2d coords: x=0 y=1
[DBG]   page_idx=0 token_id=0
[DBG]   page_idx=0 token_id=0
[DBG] MMA tile=1 stage=1 valid=64
[DBG] epilogue tile=0 inserting 64 candidates, topk_count_before=0
[DBG]   q_addr=0x14e00 (align%128=0), k_addr=0x2400 (align%128=0)
[DBG]   a_desc=0x40004040000014e0, b_desc=0x4000404000000240
[DBG]   kIdesc=0x4100010, tmem_d=0
[DBG] epilogue tile=0 topk_count_after=64
[DBG] pipeline done. topk_count=2048
[DBG] output[0..3]: 781 8063 5347 5686 (topk_count=2048)
[DBG] kernel exit
```"